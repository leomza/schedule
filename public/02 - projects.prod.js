"use strict";var projectIdEdit,projectsInfo=[],handleFormProject=document.querySelector("#formCreateProject");function handleNewProject(t){var n,o,r,a,c,i,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),n=t.target.elements,o=n.projectName,n.clientId,a=n.projectType,c=n.status,i=n.totalHours,o=o.value,r=selectClientName.value,a=a.value,c=c.value,i=i.valueAsNumber,modalCreate.style.display="none",modalCreateProject&&(modalCreateProject.style.display="none"),t.target.reset(),s={projectName:o,clientId:r,projectType:a,status:c,totalHours:i},e.next=14,regeneratorRuntime.awrap(axios.post("/projects/addNew",s));case 14:swal("Good job!","New project added succesfully!","success"),renderProjects(),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.error(e.t0);case 21:case"end":return e.stop()}},null,null,[[0,18]])}function uploadClientNames(){var t,n,o,r,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(axios.get("/clients/getAllClients"));case 3:for(t=e.sent,n=t.data.infoClients,o=document.getElementById("selectClientName"),r=0;r<n.length;r++)(a=document.createElement("option")).value=n[r].id,a.innerHTML=n[r].clientname,o.appendChild(a);e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}},null,null,[[0,9]])}function renderProjects(o){var t,n,r,a,c,i,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=document.querySelector(".table")){e.next=4;break}throw new Error("There is a problem finding table from HTML");case 4:return e.next=6,regeneratorRuntime.awrap(axios.get("/clients/getAllClients"));case 6:if(n=e.sent,r=n.data.infoClients,o){e.next=13;break}return e.next=11,regeneratorRuntime.awrap(axios.get("/projects/getAllprojects"));case 11:projectsInfo=e.sent,o=projectsInfo.data.infoProjects;case 13:for(a=function(t){var n=o[t];r.forEach(function(e){e.id===n.clientId&&Object.assign(o[t],e)})},c=0;c<o.length;c++)a(c);i=o.sort(function(e,t){return e.projectName.localeCompare(t.projectName)}),s=i.map(function(e){return timeInProject=convertTimeToMinuteAndHours(e.usedHours),timeSpendInDesign=convertTimeToMinuteAndHours(e.timeInDesign),"<tr>\n                <td>".concat(e.projectName,"</td>\n                <td>").concat(e.clientname,"</td>\n                <td>").concat(e.projectType,"</td>\n                <td>").concat(e.callLimitPerDay,"</td>\n                <td>").concat(timeSpendInDesign,"</td>\n                <td>").concat(e.totalHours,":00 / ").concat(timeInProject,"</td>\n                <td>").concat(e.status,'</td>\n                <td>\n                <img src="./img/edit.png" alt="" onclick=\'editProject("').concat(e.projectUuid,'")\' title="Edit"> \n                <img src="./img/delete.png" alt="" onclick=\'removeProject("').concat(e.projectUuid,'", "').concat(e.projectName,'")\' title="Remove">\n                </td>\n            </tr>')}).join(""),t.innerHTML=s,e.next=24;break;case 20:e.prev=20,e.t0=e.catch(0),swal("Ohhh no!",e.t0.response.data,"warning"),console.error(e.t0);case 24:case"end":return e.stop()}},null,null,[[0,20]])}function convertTimeToMinuteAndHours(e){try{var t=3600*e,n=0,o=0;return 60<t&&(n=parseInt(t/60),t=parseInt(t%60),60<n&&(o=parseInt(n/60),n=parseInt(n%60))),result=n<10?"".concat(o,":0").concat(n):"".concat(o,":").concat(n),result}catch(e){console.error(e)}}function removeProject(t,e){try{swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this project ".concat(e,"!"),icon:"warning",buttons:!0,dangerMode:!0}).then(function(e){e?deleteProject(t):swal("Your project is safe!")})}catch(e){console.error(e)}}function deleteProject(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(axios.delete("/projects/deleteProject/".concat(t)));case 3:renderProjects(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0);case 9:case"end":return e.stop()}},null,null,[[0,6]])}function editProject(t){var n,o,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,modalEdit){e.next=3;break}throw new Error("There is a problem finding the modal in the HTML");case 3:if(modalEdit.style.display="block",modalEdit.classList.add("showModal"),n=document.querySelector("#formEdit")){e.next=8;break}throw new Error("There is a problem finding form from HTML");case 8:return e.next=10,regeneratorRuntime.awrap(axios.get("projects/findProject/".concat(t)));case 10:o=e.sent,showClientNameInDOM((r=o.data.foundProject).clientId).then(function(e){var t='\n            <h3>Edit Project</h3>\n        <div>\n      \n        <input type="text" name="projectName" value="'.concat(r.projectName,'" placeholder="Project name" required>\n        </div>\n\n        <div>\n      \n        <select onclick="uploadClientNamesEdit()" name="selectClientName" id="selectClientNameEdit">\n        <option id="option').concat(r.clientId,'" value="').concat(r.clientId,'" selected disabled hidden>').concat(e,'</option>    \n        </select>\n        </div>\n\n        <div>\n   \n        <select name="projectType" id="projectType">\n            <option value="').concat(r.projectType,'" selected disabled hidden>').concat(r.projectType,'</option>\n            <option value="logo">Logo</option>\n            <option value="graphicLanguage">Graphic Language</option>\n            <option value="corporateWebsite">Corporate Website</option>\n            <option value="landingPage">Landing Page</option>\n            <option value="ecommerce">Ecommerce</option>\n            <option value="branding">Branding</option>\n            <option value="post">Post</option>\n            <option value="packageDesign">Package Design</option>\n            <option value="banner">Banner</option>\n            <option value="rollUp">Roll Up</option>\n            <option value="flyer">Flyer</option>\n            <option value="digitalBook">Digital Book</option>\n            <option value="newsLetter">News Letter</option>\n            <option value="calendar">Calendar</option>\n            <option value="businessCard">Business Card</option>\n            <option value="presentation">Presentation</option>\n            <option value="designedPage">Designed Page</option>\n            <option value="all">All</option>\n        </select>\n        </div>\n\n        <div>\n       \n        <select name="status" id="status">\n            <option value="').concat(r.status,'" selected disabled hidden>').concat(r.status,'</option>\n            <option value="offerPending">Offer Pending</option>\n            <option value="inProgress">In Progress</option>\n            <option value="offerApproved">Offer Approved</option>\n            <option value="stuck">Stuck</option>\n            <option value="paidUp">Paid Up</option>\n            <option value="waitingForSketchApproval">Waiting for Sketch Approval</option>\n            <option value="postponed">Postponed</option>\n            <option value="canceled">Canceled</option>\n            <option value="finished">Finished</option>\n        </select>\n        </div>\n\n        <div>\n     \n            <input type="number" name="totalHours" value="').concat(r.totalHours,'" placeholder="Total Hours for the project">\n        </div>\n                     <input type="submit" value="Update project" class="button-form" />\n        ');n.innerHTML=t,projectIdEdit=r.projectUuid}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0);case 18:case"end":return e.stop()}},null,null,[[0,15]])}function showClientNameInDOM(t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(axios.get("clients/findClient/".concat(t)));case 2:if((n=e.sent).data.foundClient){e.next=8;break}return n="No client assigned",e.abrupt("return",n);case 8:return e.abrupt("return",n.data.foundClient.clientname);case 9:case"end":return e.stop()}})}function handleEdit(t){var n,o,r,a,c,i,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=t.target.elements,o=n.projectName,r=n.clientId,a=n.projectType,c=n.status,i=n.totalHours,o=o.value,r=selectClientNameEdit.value,a=a.value,c=c.value,i=i.valueAsNumber,o){e.next=9;break}throw new Error("You need to complete the project name");case 9:if(modalEdit){e.next=11;break}throw new Error("There is a problem finding modalEdit from HTML");case 11:return modalEdit.style.display="none",t.target.reset(),s={projectName:o,clientId:r,projectType:a,status:c,totalHours:i},e.next=16,regeneratorRuntime.awrap(axios.put("/projects/editProject/".concat(projectIdEdit),s));case 16:renderProjects(),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),swal("Ohhh no!","".concat(e.t0),"warning"),console.error(e.t0);case 23:case"end":return e.stop()}},null,null,[[0,19]])}function uploadClientNamesEdit(){var t,n,o,r,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(axios.get("/clients/getAllClients"));case 3:for(t=e.sent,n=t.data.infoClients,o=document.getElementById("selectClientNameEdit"),r=0;r<n.length;r++)(a=document.createElement("option")).value=n[r].id,a.innerHTML=n[r].clientname,o.appendChild(a);o.onclick=null,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}},null,null,[[0,10]])}function deleteInfoRetailer(){var t,o,n,r,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,1===(new Date).getDate())return e.next=4,regeneratorRuntime.awrap(axios.get("/clients/getAllClients"));e.next=13;break;case 4:return t=e.sent,o=t.data.infoClients,e.next=8,regeneratorRuntime.awrap(axios.get("/projects/getAllprojects"));case 8:for(n=e.sent,projectsToShow=n.data.infoProjects,r=function(t){var n=projectsToShow[t];o.forEach(function(e){e.id===n.clientId&&Object.assign(projectsToShow[t],e)})},a=0;a<projectsToShow.length;a++)r(a);projectsToShow.forEach(function(e){"retainer"===e.dealTime&&restartInfoInProject(e)});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0);case 18:case"end":return e.stop()}},null,null,[[0,15]])}function restartInfoInProject(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(axios.put("/projects/resetRetailerInfo/".concat(t.projectUuid)));case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0);case 8:case"end":return e.stop()}},null,null,[[0,5]])}handleFormProject.addEventListener("submit",handleNewProject);var searchSpecific=document.getElementById("search_specific");function searchSpecificDay(e){var t=e.target.value,n=projectsInfo.data.infoProjects.filter(function(e){return console.log(e),e.projectName.includes(t)});console.log(n)}searchSpecific.addEventListener("change",searchSpecificDay);