"use strict";var __awaiter=this&&this.__awaiter||function(e,a,l,o){return new(l=l||Promise)(function(n,t){function r(e){try{s(o.next(e))}catch(e){t(e)}}function i(e){try{s(o.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,i)}s((o=o.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(n,r){var i,s,a,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,s&&(a=2&t[0]?s.return:t[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,s=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],s=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};exports.__esModule=!0,exports.setClientTime=exports.getAClient=exports.editClient=exports.deleteClient=exports.getAllClients=exports.registerClient=void 0;var uuidv4=require("uuid").v4,admin=require("firebase-admin"),db=admin.firestore(),clientsDb=db.collection("clients");function registerClient(c,u){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,s,a,l,o;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=c.body,n=t.clientname,r=t.phone,i=t.email,s=t.dealTime,a=t.callLimitPerDay,l=uuidv4(),[4,clientsDb.doc(l).set({clientname:n,phone:r,email:i,dealTime:s,callLimitPerDay:a,createdDate:Date.now(),lastDesignDate:"",lastCallDate:"",id:l})];case 1:return e.sent(),u.send({message:"A new Client was register"}),[3,3];case 2:return o=e.sent(),console.error(o),u.status(500).send(o.message),[3,3];case 3:return[2]}})})}function getAllClients(e,r){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=[],[4,db.collection("clients").get()];case 1:return e.sent().forEach(function(e){t.push(e.data())}),r.send({message:"Information of the clients",infoClients:t}),[3,3];case 2:return n=e.sent(),console.error(n),r.status(500).send(n.message),[3,3];case 3:return[2]}})})}function deleteClient(r,i){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=r.params.idClient,[4,db.collection("clients").doc(t).delete()];case 1:return e.sent(),i.send({message:"The client was deleted"}),[3,3];case 2:return n=e.sent(),console.error(n),i.status(500).send(n.message),[3,3];case 3:return[2]}})})}function editClient(c,u){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,s,a,l,o;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=c.params.idClient,n=c.body,r=n.clientname,i=n.phone,s=n.email,a=n.dealTime,l=n.callLimitPerDay,[4,db.collection("clients").doc(t).set({clientname:r,phone:i,email:s,dealTime:a,callLimitPerDay:l},{merge:!0})];case 1:return e.sent(),u.send({message:"The client was updated"}),[3,3];case 2:return o=e.sent(),console.error(o),u.status(500).send(o.message),[3,3];case 3:return[2]}})})}function getAClient(s,a){return __awaiter(this,void 0,void 0,function(){var t,n,r,i;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=s.params.idClient,[4,db.collection("clients").doc(t).get()];case 1:return n=e.sent(),r=n.data(),a.send({message:"The client was founded",foundClient:r}),[3,3];case 2:return i=e.sent(),console.error(i),[3,3];case 3:return[2]}})})}function setClientTime(l,o){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,s,a;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,6,,7]),t=l.params,n=t.idProject,r=t.typeOfButton,[4,db.collection("projects").doc(n).get()];case 1:return i=e.sent(),s=i.data(),"design"!==r?[3,3]:[4,db.collection("clients").doc(s.clientId).set({lastDesignDate:new Date},{merge:!0})];case 2:return e.sent(),[3,5];case 3:return"call"!==r?[3,5]:[4,db.collection("clients").doc(s.clientId).set({lastCallDate:new Date},{merge:!0})];case 4:e.sent(),e.label=5;case 5:return o.send({message:"The client time was updated"}),[3,7];case 6:return a=e.sent(),console.error(a),[3,7];case 7:return[2]}})})}exports.registerClient=registerClient,exports.getAllClients=getAllClients,exports.deleteClient=deleteClient,exports.editClient=editClient,exports.getAClient=getAClient,exports.setClientTime=setClientTime;