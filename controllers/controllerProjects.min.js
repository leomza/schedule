"use strict";var __awaiter=this&&this.__awaiter||function(e,a,c,i){return new(c=c||Promise)(function(r,t){function s(e){try{n(i.next(e))}catch(e){t(e)}}function o(e){try{n(i.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(s,o)}n((i=i.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(r,s){var o,n,a,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(a=2&t[0]?n.return:t[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,t[1])).done)return a;switch(n=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,n=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=s.call(r,c)}catch(e){t=[6,e],n=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};exports.__esModule=!0,exports.resetRetailerInfo=exports.setProjectTime=exports.addTask=exports.getAProject=exports.editProject=exports.deleteProject=exports.getAllProjects=exports.registerProject=void 0;var uuidv4=require("uuid").v4,admin=require("firebase-admin"),db=admin.firestore(),projectsDb=db.collection("projects");function registerProject(u,d){return __awaiter(this,void 0,void 0,function(){var t,r,s,o,n,a,c,i;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=u.body,r=t.projectName,s=t.clientId,o=t.projectType,n=t.status,a=t.totalHours,c=uuidv4(),[4,projectsDb.doc(c).set({projectName:r,clientId:s,projectType:o,status:n,totalHours:a,projectUuid:c,createdDate:Date.now(),usedHours:0,timeInDesign:0,tasks:[]})];case 1:return e.sent(),d.send({message:"A new Project was register"}),[3,3];case 2:return i=e.sent(),console.error(i),d.status(500).send(i.message),[3,3];case 3:return[2]}})})}function getAllProjects(e,s){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=[],[4,db.collection("projects").get()];case 1:return e.sent().forEach(function(e){t.push(e.data())}),s.send({message:"Information of the projects",infoProjects:t}),[3,3];case 2:return r=e.sent(),console.error(r),s.status(500).send(r.message),[3,3];case 3:return[2]}})})}function deleteProject(s,o){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=s.params.idProject,[4,db.collection("projects").doc(t).delete()];case 1:return e.sent(),o.send({message:"The project was deleted"}),[3,3];case 2:return r=e.sent(),console.error(r),o.status(500).send(r.message),[3,3];case 3:return[2]}})})}function editProject(u,d){return __awaiter(this,void 0,void 0,function(){var t,r,s,o,n,a,c,i;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=u.params.idProject,r=u.body,s=r.projectName,o=r.clientId,n=r.projectType,a=r.status,c=r.totalHours,[4,db.collection("projects").doc(t).set({projectName:s,clientId:o,projectType:n,status:a,totalHours:c},{merge:!0})];case 1:return e.sent(),d.send({message:"The project was updated"}),[3,3];case 2:return i=e.sent(),console.error(i),d.status(500).send(i.message),[3,3];case 3:return[2]}})})}function getAProject(n,a){return __awaiter(this,void 0,void 0,function(){var t,r,s,o;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=n.params.idProject,[4,db.collection("projects").doc(t).get()];case 1:return r=e.sent(),s=r.data(),a.send({message:"The project was founded",foundProject:s}),[3,3];case 2:return o=e.sent(),console.error(o),a.status(500).send(o.message),[3,3];case 3:return[2]}})})}function addTask(n,a){return __awaiter(this,void 0,void 0,function(){var t,r,s,o;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=n.body,r=t.uuid,s=t.idProject,[4,db.collection("projects").doc(s).set({tasks:admin.firestore.FieldValue.arrayUnion(r)},{merge:!0})];case 1:return e.sent(),a.send({message:"The task was added to the project"}),[3,3];case 2:return o=e.sent(),console.error(o),a.status(500).send(o.message),[3,3];case 3:return[2]}})})}function setProjectTime(i,u){return __awaiter(this,void 0,void 0,function(){var t,r,s,o,n,a,c;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),t=i.params,r=t.idProject,s=t.timeInHours,o=t.typeOfButton,[4,db.collection("projects").doc(r).get()];case 1:return n=e.sent(),a=n.data(),s=parseFloat(s),[4,db.collection("projects").doc(r).set({usedHours:a.usedHours+s},{merge:!0})];case 2:return e.sent(),"design"!==o?[3,4]:[4,db.collection("projects").doc(r).set({timeInDesign:a.timeInDesign+s},{merge:!0})];case 3:e.sent(),e.label=4;case 4:return u.send({message:"The time was added to the project"}),[3,6];case 5:return c=e.sent(),console.error(c),[3,6];case 6:return[2]}})})}function resetRetailerInfo(s,e){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=s.params.idProject,[4,db.collection("projects").doc(t).set({usedHours:0,timeInDesign:0},{merge:!0})];case 1:return e.sent(),[3,3];case 2:return r=e.sent(),console.error(r),[3,3];case 3:return[2]}})})}exports.registerProject=registerProject,exports.getAllProjects=getAllProjects,exports.deleteProject=deleteProject,exports.editProject=editProject,exports.getAProject=getAProject,exports.addTask=addTask,exports.setProjectTime=setProjectTime,exports.resetRetailerInfo=resetRetailerInfo;